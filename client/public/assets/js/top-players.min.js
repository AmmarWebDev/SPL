"use strict";const topPlayersSection=document.getElementById("top-players");function openConfirmResultModal(){const t=document.getElementById("add-result-modal"),e=document.getElementById("confirm-result-modal"),s=bootstrap.Modal.getInstance(t),a=new bootstrap.Modal(e),n=document.getElementById("league-name").value,o=document.getElementById("match-result").value.trim();try{const e=o.split("\n").map((t=>t.trim())).filter(Boolean),r={scorers:[],cards:[],goalkeepers:[]},l=`(?:${/(?::[\w]+:|<:[\w]+:\d+>)/.source})?\\s*`;if(!e[0].startsWith("# "))throw new Error("Missing header");const i=e[0].replace(/^# /,"").trim(),c=i.lastIndexOf(" ");if(-1===c)throw new Error("Invalid header format");r.competition=i.slice(0,c).trim(),r.stage=i.slice(c+1).toLowerCase().replace(/\s+/g,"-");const d=e[1],m=new RegExp(`^#\\s*${l}<@&(\\d+)>\\s+(\\d+)\\s*-\\s*(\\d+)\\s+<@&(\\d+)>\\s*${l}$`),h=d.match(m);if(!h)throw new Error("Invalid match line");r.teamA={roleId:h[1],score:parseInt(h[2])},r.teamB={roleId:h[4],score:parseInt(h[3])};let p=2;if(e[p]&&e[p].startsWith("# REF:")){const t=e[p].match(/^# REF:\s*<@(\d+)>/);t&&(r.referee=t[1]),p++}if(!e[p]||!e[p].startsWith("# STATS:"))throw new Error("Missing # STATS:");for(p++;p<e.length&&!e[p].startsWith("#");){const t=e[p].match(new RegExp(`^${l}<@&(\\d+)>\\s+<@(\\d+)>:\\s*(\\d+) goal[s]?[,\\s]*(\\d+)? assist[s]?$`));t&&r.scorers.push({teamRoleId:t[1],userId:t[2],goals:parseInt(t[3]),assists:t[4]?parseInt(t[4]):0}),p++}if(e[p]&&e[p].startsWith("# Cards:"))for(p++;p<e.length&&!e[p].startsWith("#");){const t=e[p].match(new RegExp(`^${l}<@&(\\d+)>\\s+<@(\\d+)>\\s+(üü®|üü•)$`));t&&r.cards.push({teamRoleId:t[1],userId:t[2],card:t[3]}),p++}if(!e[p]||!e[p].startsWith("# Goalkeepers:"))throw new Error("Missing # Goalkeepers:");for(p++;p<e.length&&!e[p].startsWith("#");){const t=e[p].match(new RegExp(`^${l}<@&(\\d+)>\\s+<@(\\d+)>$`));t&&r.goalkeepers.push({teamRoleId:t[1],userId:t[2]}),p++}if(!e[p]||!e[p].startsWith("# MOTM:"))throw new Error("Missing # MOTM:");const g=e[p].match(/^# MOTM:\s*<@(\d+)>/);if(!g)throw new Error("Invalid MOTM format");r.motm=g[1],console.log(r),document.getElementById("confirm-result-modal-body").innerHTML=`You are going to post a new result to ${n}`,s?(t.addEventListener("hidden.bs.modal",(()=>{a.show()}),{once:!0}),s.hide()):a.show()}catch(t){console.log("invalid template:",t.message)}}document.querySelector('.navbar-collapse a[href="index.html"]').classList.toggle("active"),document.querySelector('.navbar-collapse a[href="top-players.html"]').classList.toggle("active");const apiUrls=["http://localhost:3000/euros/top-10","http://localhost:3000/cwc/top-10"];apiUrls.forEach((t=>{axios.get(t).then((e=>{const s=e.data,a=t.split("/"),n=a[a.length-2],o="cwc"===n?"CWC":"Euros",r=document.createElement("h1");r.className="text-center mt-5",r.innerHTML=`\n        <img src="assets/images/${n}-logo.png" width="40" />\n        <span>SPL ${o}</span>\n        <img src="assets/images/${n}-logo.png" width="40" />\n      `,topPlayersSection.appendChild(r);const l=s.filter((t=>t.username)).map((t=>({id:`<@${t.userId}>`,username:t.username,nickname:t.nickname,avatar:t.avatar,teamName:t.teamName?.replace(/^„ÄäSPL„Äã( *\| *)?/i,"").trim()||"Unknown",teamIcon:t.teamIcon,goals:parseInt(t.goals)||0,assists:parseInt(t.assists)||0}))),i=[...l].sort(((t,e)=>e.goals-t.goals||e.assists-t.assists)).slice(0,10),c=[...l].sort(((t,e)=>e.assists-t.assists||e.goals-t.goals)).slice(0,10),d=(t,e,s)=>{const a="goals"===s?"Goals":"Assists";return`\n          <h2 class="text-light text-center responsive-text">üèÜ Top 10 ${o} ${a} üèÜ</h2>\n          <table class="table table-striped table-bordered table-hover text-center w-100 my-3 mx-auto" style="max-width: 600px">\n            <thead>\n              <tr>\n                <th>Player</th>\n                <th>Team</th>\n                <th>${a}</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.map((t=>`\n                <tr>\n                  <td class="align-middle text-center">\n                    <div class="d-flex align-items-center justify-between gap-2">\n                      <img src="${t.avatar}" width="32" height="32" style="border-radius: 50%" />\n                      <span class="w-100">${t.username}</span>\n                    </div>\n                  </td>\n                  <td class="align-middle text-center">\n                    <div class="d-flex align-items-center justify-content-center gap-2">\n                      <span>${t.teamName}</span>\n                      ${t.teamIcon?`<img src="${t.teamIcon}" width="20" height="20" />`:""}\n                    </div>\n                  </td>\n                  <td class="align-middle text-center">${t[s]}</td>\n                </tr>\n              `)).join("")}\n            </tbody>\n          </table>\n        `},m=d(0,i,"goals"),h=d(0,c,"assists");topPlayersSection.insertAdjacentHTML("beforeend",`\n        <div class="row">\n          <div class="col-12 col-lg-6">${m}</div>\n          <div class="col-12 col-lg-6">${h}</div>\n        </div>\n      `);const p=[];p.push(`# SPL ${o} Top 10 Scorers Till Now:`),i.forEach(((t,e)=>{if(t.goals>0){const s=1===t.goals?"goal":"goals";p.push(`### ${e+1}. ${t.id} (${t.teamName}): ${t.goals} ${s}`)}})),p.push(`\n# SPL ${o} Top 10 Assistors Till Now:`),c.forEach(((t,e)=>{if(t.assists>0){const s=1===t.assists?"assist":"assists";p.push(`### ${e+1}. ${t.id} (${t.teamName}): ${t.assists} ${s}`)}}));const g=document.createElement("button");g.className="btn btn-primary my-4 d-block mx-auto",g.textContent=`üìã Copy SPL ${o} Summary`,g.addEventListener("click",(()=>{navigator.clipboard.writeText(p.join("\n")).then((()=>{g.textContent="‚úÖ Copied!",setTimeout((()=>{g.textContent=`üìã Copy SPL ${o} Summary`}),2e3)})).catch((t=>{console.error("Copy failed",t),g.textContent="‚ùå Failed to Copy"}))})),topPlayersSection.appendChild(g),t!==apiUrls[apiUrls.length-1]&&topPlayersSection.insertAdjacentHTML("beforeend",'<hr class="border-white border-2 opacity-100" style="margin:70px 0;" />')})).catch((t=>console.error("Error fetching API:",t)))}));